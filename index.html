<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FLAGS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --accent: #3b82f6;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #fef3c7 0%, #a5b4fc 40%, #22c55e 80%, #0f172a 100%);
      color: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: background 400ms ease;
    }

    body.whiteout {
      background: #ffffff;
    }

    .app {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2.5rem;
      padding: 2.5rem 1.5rem;
      max-width: 420px;
      width: min(90vw, 420px);
      z-index: 2;
      transition: opacity 500ms ease, transform 400ms ease;
    }

    .app.fade-out {
      opacity: 0;
      transform: scale(0.96);
    }

    .title {
      font-size: clamp(2.4rem, 6vw, 3rem);
      letter-spacing: 0.35em;
      text-indent: 0.35em;
      font-weight: 600;
      color: #020617;
      text-transform: uppercase;
      text-align: center;
    }

    .toggles {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 1.1rem;
      width: 100%;
    }

    .toggle {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.35rem 0.25rem;
      cursor: pointer;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.95));
      box-shadow:
        0 0 26px rgba(34, 197, 94, 0.55);
      transform: translateZ(0);
      transition: box-shadow 180ms ease, transform 120ms ease, background 180ms ease;
    }

    .toggle:hover {
      transform: translateY(-1px);
      box-shadow:
        0 0 30px rgba(34, 197, 94, 0.75);
    }

    .toggle.off {
      box-shadow:
        0 0 18px rgba(239, 68, 68, 0.7);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 1));
    }

    .toggle-number {
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.18em;
      text-indent: 0.18em;
      color: #e5e7eb;
      padding-left: 0.5rem;
      flex: 0 0 auto;
    }

    .toggle-track {
      position: relative;
      flex: 1;
      max-width: 220px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 0, rgba(15, 23, 42, 0.6), rgba(15, 23, 42, 1));
      overflow: hidden;
      display: flex;
      align-items: center;
      padding: 0 6px 0 6px;
    }

    .toggle-input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      z-index: 3;
    }

    .toggle-thumb {
      position: relative;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #f9fafb, #d1d5db);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 1),
        0 4px 10px rgba(15, 23, 42, 0.7);
      transform: translateX(0);
      transition: transform 180ms ease-out, background 180ms ease, box-shadow 180ms ease;
      z-index: 2;
    }

    .toggle.on .toggle-thumb {
      transform: translateX(110px);
      background: radial-gradient(circle at 30% 0, #f9fafb, #bbf7d0);
      box-shadow:
        0 0 0 1px rgba(5, 46, 22, 1),
        0 0 20px rgba(34, 197, 94, 0.9);
    }

    .toggle.off .toggle-thumb {
      transform: translateX(0);
      background: radial-gradient(circle at 30% 0, #fee2e2, #fecaca);
      box-shadow:
        0 0 0 1px rgba(127, 29, 29, 1),
        0 0 18px rgba(239, 68, 68, 0.9);
    }

    .status-light {
      position: absolute;
      right: 10px;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow:
        0 0 0 1px rgba(5, 46, 22, 1),
        0 0 16px rgba(34, 197, 94, 0.9);
      transition: background 150ms ease, box-shadow 150ms ease, opacity 150ms ease;
      z-index: 1;
    }

    .toggle.off .status-light {
      background: #ef4444;
      box-shadow:
        0 0 0 1px rgba(127, 29, 29, 1),
        0 0 16px rgba(239, 68, 68, 0.9);
    }

    /* Eyes / overlay, behind toggles */

    .overlay {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1;
      overflow: hidden;
      pointer-events: none;
    }

    .overlay.active {
      display: flex;
    }

    .eyes {
      display: flex;
      gap: 3rem;
      align-items: center;
      justify-content: center;
    }

    .eye {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle, #f97373 0%, #b91c1c 55%, #7f1d1d 100%);
      box-shadow:
        0 0 14px rgba(248, 113, 113, 0.9),
        0 0 32px rgba(248, 113, 113, 0.7);
      transform: scale(0);
      opacity: 0;
    }

    .eye-left { transform-origin: 100% 50%; }
    .eye-right { transform-origin: 0% 50%; }

    @keyframes eyesSlowGrow {
      0%   { transform: scale(0.15); opacity: 0; }
      25%  { opacity: 1; }
      100% { transform: scale(2.5); opacity: 1; }
    }

    @keyframes eyesRush {
      0%   { transform: scale(2.5); opacity: 1; }
      100% { transform: scale(80); opacity: 1; }
    }

    .eye.slow {
      animation: eyesSlowGrow 2s ease-out forwards;
    }

    .eye.rush {
      animation: eyesRush 0.5s ease-in forwards;
    }

    @media (max-width: 480px) {
      .app {
        padding: 2rem 1.2rem;
      }

      .toggle-track {
        max-width: 190px;
      }

      .toggle.on .toggle-thumb {
        transform: translateX(90px);
      }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <h1 class="title">FLAGS</h1>
    <div class="toggles" id="toggles">
      <label class="toggle on" data-index="1">
        <span class="toggle-number">1</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-1" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="2">
        <span class="toggle-number">2</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-2" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="3">
        <span class="toggle-number">3</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-3" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="4">
        <span class="toggle-number">4</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-4" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="5">
        <span class="toggle-number">5</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-5" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="6">
        <span class="toggle-number">6</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-6" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="7">
        <span class="toggle-number">7</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-7" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
      <label class="toggle on" data-index="8">
        <span class="toggle-number">8</span>
        <div class="toggle-track">
          <input type="checkbox" class="toggle-input" id="toggle-8" checked />
          <span class="toggle-thumb"></span>
          <span class="status-light"></span>
        </div>
      </label>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="eyes">
      <div class="eye eye-left"></div>
      <div class="eye eye-right"></div>
    </div>
  </div>

  <script>
    (function () {
      const colors = {
        1: { r: 59, g: 130, b: 246 },   // blue
        2: { r: 250, g: 204, b: 21 },   // yellow
        3: { r: 244, g: 114, b: 182 },  // pink
        4: { r: 45, g: 212, b: 191 },   // teal
        5: { r: 74, g: 222, b: 128 },   // green
        6: { r: 249, g: 115, b: 22 },   // orange
        8: { r: 167, g: 139, b: 250 }   // violet
      };

      const toggles = Array.from(document.querySelectorAll(".toggle"));
      const overlay = document.getElementById("overlay");
      const eyes = overlay.querySelectorAll(".eye");
      const app = document.getElementById("app");
      const docRoot = document.documentElement;
      const body = document.body;

      let sequenceRunning = false;

      function blendActiveColours() {
        if (sequenceRunning) return;

        const activeColours = [];

        toggles.forEach(toggle => {
          const idx = Number(toggle.dataset.index);
          const input = toggle.querySelector(".toggle-input");
          if (!input.checked) return;
          if (idx === 7) return;
          const c = colors[idx];
          if (c) activeColours.push(c);
        });

        let r, g, b;

        if (activeColours.length === 0) {
          r = 15; g = 23; b = 42;
        } else {
          const total = activeColours.length;
          r = activeColours.reduce((sum, c) => sum + c.r, 0) / total;
          g = activeColours.reduce((sum, c) => sum + c.g, 0) / total;
          b = activeColours.reduce((sum, c) => sum + c.b, 0) / total;
        }

        const colour = `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
        docRoot.style.setProperty("--accent", colour);
      }

      function updateToggleStates() {
        toggles.forEach(toggle => {
          const input = toggle.querySelector(".toggle-input");
          if (input.checked) {
            toggle.classList.add("on");
            toggle.classList.remove("off");
          } else {
            toggle.classList.remove("on");
            toggle.classList.add("off");
          }
        });
      }

      function resetAllToggles() {
        toggles.forEach(toggle => {
          const input = toggle.querySelector(".toggle-input");
          input.checked = true;
        });
        updateToggleStates();
        blendActiveColours();
      }

      function clearEyesAnimation() {
        eyes.forEach(eye => {
          eye.classList.remove("slow", "rush");
          eye.style.transform = "";
          eye.style.opacity = "";
        });
      }

      function runSequence() {
        if (sequenceRunning) return;
        sequenceRunning = true;

        overlay.classList.add("active");
        app.classList.add("fade-out");
        clearEyesAnimation();

        eyes.forEach(eye => {
          void eye.offsetWidth;
          eye.classList.add("slow");
        });

        setTimeout(() => {
          eyes.forEach(eye => {
            eye.classList.remove("slow");
            void eye.offsetWidth;
            eye.classList.add("rush");
          });
        }, 2000);

        setTimeout(() => {
          overlay.classList.remove("active");
          body.classList.add("whiteout");
          clearEyesAnimation();
        }, 2500);

        setTimeout(() => {
          body.classList.remove("whiteout");
          app.classList.remove("fade-out");
          resetAllToggles();
          sequenceRunning = false;
        }, 3500);
      }

      function handleToggleChange(event) {
        const input = event.target;
        const toggle = input.closest(".toggle");
        const idx = Number(toggle.dataset.index);

        updateToggleStates();

        if (idx === 7 && !input.checked) {
          runSequence();
        } else if (!sequenceRunning) {
          blendActiveColours();
        }
      }

      toggles.forEach(toggle => {
        const input = toggle.querySelector(".toggle-input");
        input.addEventListener("change", handleToggleChange);
      });

      updateToggleStates();
      blendActiveColours();
    })();
  </script>
</body>
</html>
